(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[587],{7079:function(e,t,r){Promise.resolve().then(r.bind(r,7708))},7708:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return p}});var a=r(7437),s=r(2265),i=r(998),l=r(6463),n=r(9343),o=r(1014),c=r(6700),d=r(6648);function u(e){let{images:t,onImagesChange:r,maxImages:i=5}=e,[l,n]=(0,s.useState)(!1),o=async e=>{let a=e.target.files;if(!a||0===a.length)return;if(t.length+a.length>i){alert("You can only upload up to ".concat(i," images"));return}n(!0);let s=[...t];for(let e=0;e<a.length;e++){let t=a[e],r=new FormData;r.append("file",t),r.append("folder","cakes");try{let e=await fetch("/api/upload",{method:"POST",body:r});if(!e.ok)throw Error("Upload failed");let t=await e.json();s.push(t.url)}catch(e){console.error("Error uploading image:",e),alert("Failed to upload image. Please try again.")}}r(s),n(!1)},c=e=>{r(t.filter((t,r)=>r!==e))};return(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4 mb-4",children:[t.map((e,t)=>(0,a.jsxs)("div",{className:"relative group",children:[(0,a.jsx)("div",{className:"relative h-32 rounded-lg overflow-hidden",children:(0,a.jsx)(d.default,{src:e,alt:"Cake image ".concat(t+1),fill:!0,className:"object-cover"})}),(0,a.jsx)("button",{type:"button",onClick:()=>c(t),className:"absolute top-2 right-2 bg-red-500 text-white p-1 rounded-full opacity-0 group-hover:opacity-100 transition-opacity",children:(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]},t)),t.length<i&&(0,a.jsxs)("label",{className:"relative h-32 border-2 border-dashed border-gray-300 rounded-lg flex items-center justify-center cursor-pointer hover:border-cake-pink",children:[(0,a.jsx)("input",{type:"file",accept:"image/*",multiple:!0,onChange:o,className:"sr-only",disabled:l}),(0,a.jsx)("div",{className:"text-center",children:l?(0,a.jsx)("span",{className:"text-gray-500",children:"Uploading..."}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("svg",{className:"mx-auto h-8 w-8 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),(0,a.jsx)("span",{className:"text-sm text-gray-500",children:"Add Image"})]})})]})]}),(0,a.jsxs)("p",{className:"text-sm text-gray-500",children:["Upload up to ",i," images. Recommended size: 1200x1200px"]})]})}let m=c.z.object({title:c.z.string().min(3,"Title must be at least 3 characters"),description:c.z.string().min(20,"Description must be at least 20 characters"),price:c.z.number().positive("Price must be positive"),category:c.z.string().min(1,"Please select a category"),images:c.z.array(c.z.string()).min(1,"At least one image is required")});function p(){let{data:e,status:t}=(0,i.useSession)(),r=(0,l.useRouter)(),[c,d]=(0,s.useState)([]),[p,g]=(0,s.useState)([]),{register:x,handleSubmit:h,setValue:f,formState:{errors:b,isSubmitting:y}}=(0,n.cI)({resolver:(0,o.F)(m)});(0,s.useEffect)(()=>{"unauthenticated"===t?r.push("/auth/signin"):(null==e?void 0:e.user.role)!=="BAKER"?r.push("/"):j()},[e,t,r]),(0,s.useEffect)(()=>{f("images",p)},[p,f]);let j=async()=>{try{let e=await fetch("/api/categories");if(e.ok){let t=await e.json();d(t)}}catch(e){console.error("Error fetching categories:",e)}},k=async e=>{try{if(!(await fetch("/api/cakes",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).ok)throw Error("Failed to create cake listing");r.push("/dashboard/baker/cakes")}catch(e){console.error("Error creating cake:",e),alert("Failed to create cake listing. Please try again.")}};return(0,a.jsxs)("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-8",children:"Add New Cake"}),(0,a.jsxs)("form",{onSubmit:h(k),className:"space-y-6 bg-white p-8 rounded-lg shadow",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"title",className:"block text-sm font-medium text-gray-700 mb-1",children:"Cake Title"}),(0,a.jsx)("input",{...x("title"),type:"text",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cake-pink focus:border-transparent",placeholder:"Chocolate Dream Cake"}),b.title&&(0,a.jsx)("p",{className:"text-red-500 text-sm mt-1",children:b.title.message})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),(0,a.jsx)("textarea",{...x("description"),rows:4,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cake-pink focus:border-transparent",placeholder:"Describe your cake, ingredients, flavors, and what makes it special..."}),b.description&&(0,a.jsx)("p",{className:"text-red-500 text-sm mt-1",children:b.description.message})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"price",className:"block text-sm font-medium text-gray-700 mb-1",children:"Price (\xa3)"}),(0,a.jsx)("input",{...x("price",{valueAsNumber:!0}),type:"number",step:"0.01",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cake-pink focus:border-transparent",placeholder:"35.00"}),b.price&&(0,a.jsx)("p",{className:"text-red-500 text-sm mt-1",children:b.price.message})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"category",className:"block text-sm font-medium text-gray-700 mb-1",children:"Category"}),(0,a.jsxs)("select",{...x("category"),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cake-pink focus:border-transparent",children:[(0,a.jsx)("option",{value:"",children:"Select a category"}),c.map(e=>(0,a.jsx)("option",{value:e.id,children:e.name},e.id))]}),b.category&&(0,a.jsx)("p",{className:"text-red-500 text-sm mt-1",children:b.category.message})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Cake Images"}),(0,a.jsx)(u,{images:p,onImagesChange:g,maxImages:5}),b.images&&(0,a.jsx)("p",{className:"text-red-500 text-sm mt-1",children:b.images.message})]}),(0,a.jsxs)("div",{className:"flex gap-4",children:[(0,a.jsx)("button",{type:"submit",disabled:y,className:"flex-1 bg-gradient-to-r from-cake-pink to-cake-purple text-white py-2 px-4 rounded-lg font-medium hover:opacity-90 transition-opacity disabled:opacity-50",children:y?"Creating...":"Create Cake Listing"}),(0,a.jsx)("button",{type:"button",onClick:()=>r.back(),className:"px-6 py-2 border border-gray-300 rounded-lg font-medium hover:bg-gray-50",children:"Cancel"})]})]})]})}},6648:function(e,t,r){"use strict";r.d(t,{default:function(){return s.a}});var a=r(5601),s=r.n(a)},5601:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{default:function(){return o},getImageProps:function(){return n}});let a=r(9920),s=r(497),i=r(8173),l=a._(r(1241));function n(e){let{props:t}=(0,s.getImgProps)(e,{defaultLoader:l.default,imgConf:{deviceSizes:[640,750,828,1080,1200,1920,2048,3840],imageSizes:[16,32,48,64,96,128,256,384],path:"/_next/image",loader:"default",dangerouslyAllowSVG:!1,unoptimized:!1}});for(let[e,r]of Object.entries(t))void 0===r&&delete t[e];return{props:t}}let o=i.Image},291:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"RouterContext",{enumerable:!0,get:function(){return a}});let a=r(9920)._(r(2265)).default.createContext(null)}},function(e){e.O(0,[173,998,268,971,23,744],function(){return e(e.s=7079)}),_N_E=e.O()}]);